import{draw_chart}from"./charts.min.js";document.addEventListener("DOMContentLoaded",()=>{"use strict";const e=(e,t)=>{e instanceof HTMLElement||(e=document.querySelector(e)),e.innerText=t},t=(e,t)=>{e instanceof HTMLElement||(e=document.querySelector(e)),t?e.classList.add("active"):e.classList.remove("active")},n=n=>{if(null!==n){Object.assign(i,n),o[0]=Array(i.chart_ticks).fill(null),o[1]=Array(i.chart_ticks).fill(null),o[2]=Array(i.chart_ticks).fill(null),e("#current-sensor",i.sensors[i.sensor_index]);{const e=document.querySelector("#list-ranges");e.innerHTML="",i.ranges.forEach((n,c)=>{const r=document.createElement("li");t(r,c===i.range_index),r.innerText=n,r.addEventListener("click",()=>{l({range_index:c}),t("nav.drawer",!1)}),e.appendChild(r)})}{const e=document.querySelector("#list-sensors");e.innerHTML="",i.sensors.forEach((n,r)=>{const s=document.createElement("li");t(s,r===i.sensor_index),s.innerText=n,s.classList.add("editable"),s.addEventListener("click",e=>{e.offsetX<s.offsetX+s.offsetWidth-50?(l({sensor_index:r}),t("nav.drawer",!1)):c(r)}),e.appendChild(s)})}}};document.querySelector("#button-menu").addEventListener("click",()=>{t("nav.drawer",!0)}),document.querySelector(".drawer-backdrop").addEventListener("click",()=>{t("nav.drawer",!1)}),document.querySelector("#item-signout").addEventListener("click",()=>{location.replace("/auth/signout")});const c=e=>{const n=document.querySelector("#sensor-description");n.value=i.sensors[e],n.select();const c=document.querySelector("#dialog-sensor");c.execute=()=>{t(".overlay",!0),t("nav.drawer",!1),d({sensor_index:e,description:n.value}),c.close()},c.showModal()},r=e=>{e?(s("センサー情報の更新に成功しました"),l()):s("センサー情報の更新に失敗しました")};document.querySelectorAll("button.execute-dialog").forEach(e=>{e.addEventListener("click",()=>{const t=e.closest("dialog");"execute"in t&&t.execute()})}),document.querySelectorAll("button.cancel-dialog").forEach(e=>{e.addEventListener("click",()=>{e.closest("dialog").close()})});const s=e=>{const n=document.querySelector("#snackbar");n.innerText=e,t(n,!0),window.setTimeout(()=>{t(n,!1)},3e3)},i={ranges:[],range_index:0,sensors:[],sensor_index:0,chart_ticks:0,tick_length:0},o=[[],[],[]],a=io(`https://${location.host}`,{path:API_V1.PATH}),l=async e=>{t(".overlay",!0),a.emit(API_V1.INIT_SESSION,e,n)};a.on("connect",()=>{l()});const d=async e=>{a.emit(API_V1.UPDATE_SENSOR,e,r)};a.on(API_V1.PUSH_VALUES,t=>{(e=>Array.isArray(e)&&2===e.length&&e.every(e=>"number"==typeof e&&isFinite(e)))(t)?(e(".value-box#temp-box > .value",t[0].toFixed(1)),e(".value-box#tds-box > .value",t[1].toFixed(1))):(e(".value-box#temp-box > .value","--.-"),e(".value-box#tds-box > .value","---.-"))}),a.on(API_V1.PUSH_SERIES,e=>{if((e=>null!==e&&"min_tick"in e&&"number"==typeof e.min_tick&&isFinite(e.min_tick)&&"max_tick"in e&&"number"==typeof e.min_tick&&isFinite(e.min_tick)&&"series"in e&&Array.isArray(e.series)&&3===e.series.length&&e.series.every(t=>Array.isArray(t)&&t.length===e.max_tick-e.min_tick))(e)){const t=e.max_tick-e.min_tick;o[0]=o[0].slice(t).concat(e.series[0]),o[1]=o[1].slice(t).concat(e.series[1]),o[2]=o[2].slice(t).concat(e.series[2]),draw_chart({query:"#temp-box canvas",scale:1,series:[o[0],o[1]],colors:["#5DADE2","#82E0AA"],base_tick:e.max_tick-i.chart_ticks,ticks:i.chart_ticks,tick_length:i.tick_length,range:i.range_index}),draw_chart({query:"#tds-box canvas",scale:5,series:[o[2]],colors:["#EB984E"],base_tick:e.max_tick-i.chart_ticks,ticks:i.chart_ticks,tick_length:i.tick_length,range:i.range_index})}t(".overlay",!1)})});