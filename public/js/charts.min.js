export const draw_chart=async e=>{"use strict";const t=(e,t,i,r,s)=>{e.beginPath(),e.moveTo(t,i),e.lineTo(r,s),e.stroke()},i=document.querySelector(e.query);i.width=i.parentElement.offsetWidth,i.height=i.parentElement.offsetHeight;const r={l:Math.round(.07*i.width),r:0,t:Math.round(.03*i.height),b:Math.round(.05*i.height)};let s=null,n=15;const o=e.series.flat().filter(e=>"number"==typeof e&&isFinite(e)).map(t=>t/e.scale);if(o.length>0){const e=Math.ceil(Math.max(...o)),t=Math.floor(Math.min(...o));n=Math.max(n,e-t+6),s=Math.round((e+t)/2-n/2)}const a=(i.width-r.l-r.r+1)/e.ticks,h=(i.height-r.t-r.b+1)/n,l=e=>r.l+a*e,c=e=>i.height-r.b-h*e,f=[...Array(e.ticks).keys()].map(t=>(t=>{const i=new Date((e.base_tick+t)*e.tick_length*1e3),r=new Date((e.base_tick+t-1)*e.tick_length*1e3);switch(e.range){case 0:if(i.getHours()!==r.getHours())return strftime("%H:00",i);break;case 1:if(i.getHours()%3==0&&i.getHours()!==r.getHours())return strftime("%H:00",i);break;case 2:if(i.getDate()!==r.getDate())return strftime("%m/%d",i);break;case 3:if(0===i.getDay()&&i.getDate()!==r.getDate())return strftime("%m/%d",i)}return null})(t)),u=[...Array(n+1).keys()].map(t=>((t,i)=>null!==i&&(i+t)%5==0?((i+t)*e.scale).toString():null)(t,s)),d=i.getContext("2d");d.lineWidth=1,d.setLineDash([1,1]),d.strokeStyle="rgba(255, 255, 255, 0.5)",f.forEach((e,s)=>{if(null!==e){const e=Math.round(l(s))+.5;t(d,e,r.t,e,i.height-r.b)}}),u.forEach((e,s)=>{null!==e?d.setLineDash([]):d.setLineDash([1,1]);const n=Math.round(c(s))+.5;t(d,r.l,n,i.width-r.r,n)}),d.lineWidth=.013*Math.min(i.width,i.height),d.setLineDash([]),d.lineCap="square",d.lineJoin="round",d.shadowOffsetX=.5*d.lineWidth,d.shadowOffsetY=.5*d.lineWidth,d.shadowBlur=d.lineWidth,d.shadowColor="rgba(0, 0, 0, 0.5)",d.save(),d.rect(r.l,r.t,i.width-r.l-r.r,i.height-r.t-r.b),d.clip(),e.series.map((t,i)=>({series:t,color:e.colors[i]})).reverse().forEach(t=>{d.strokeStyle=t.color;let i=[];[...Array(e.ticks+1).keys()].forEach(r=>{r in t.series&&"number"==typeof t.series[r]&&isFinite(t.series[r])?i.push({x:l(r),y:c(t.series[r]/e.scale-s)}):(((e,t)=>{t.length<2||(e.beginPath(),t.forEach((t,i)=>{0===i?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y)}),e.stroke())})(d,i),i=[])})}),d.restore();const g=`400 ${r.b-1}px "Roboto Condensed"`;await document.fonts.load(g),d.font=g,d.textAlign="center",d.textBaseline="top",d.fillStyle="#ffffff",f.forEach((e,t)=>{if(null!==e){const s=Math.round(l(t))+.5;d.fillText(e,s,i.height-r.b+2)}}),d.textAlign="right",d.textBaseline="middle",u.forEach((e,t)=>{if(t>0&&null!==e){const i=Math.round(c(t))+.5;d.fillText(e,r.l-4,i-.5)}})};